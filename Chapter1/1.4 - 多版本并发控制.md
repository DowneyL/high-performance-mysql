### 多版本并发控制

MySQL 大多数的事务型存储引擎实现的都不是简单的行级锁。而是为了基于提升并发性能的考虑，一般都**同时**实现了多版本并发控制（Multi Version Concurrency Control）。不同的数据库系统，都按各自的机制实现了 MVCC，因为它没有统一标准。

- 行级锁的变种
- 可以避免加锁操作，开销更低
- 实现非阻塞的读操作
- 写操作也只锁定必要的行

MVCC 的实现包括乐观并发（optimistic）控制和悲观（pessimistic）并发控制

InnoDB 存储引擎的 MVCC 实现，是通过在每一行记录后面都保存两个隐藏的列来实现的，一个列用来保存行的创建时间，一个列来保存行的过期时间（或删除时间），存储的并不是实际时间，而是系统版本号（system version number），每开始一个新的事务，系统版本号就会自动递增。事务开始时刻的系统版本号会作为事务的版本 

保存这两个额外的系统版本号，可使得大多数的读操作都可以不用加锁，这种设计使得读数据操作很简单，性能很好，并且也能保证只会读到符合标准的行，不足就在于每行记录都需要额外的存储空间，需要做更多的行检查工作，以及一些额外的维护工作。

MVCC 只适用于可重复读和不可重复读两种隔离级别下工作

- 未提交读总是读取最新的数据行，所以不兼容
- 可串行化总是会对所有读取的行都加锁，所以不兼容

